#!/bin/bash
#
#	torrent o magnet
#	$1: nombre	$2: imdb



# generar un nombre|nombre| para diferentes idiomas
NOMBRE=$(echo $1 | sed 's/,\|\./ /g; s/[^a-zA-Z0-9\ -]//g; s/\ /+/g')
echo $NOMBRE > /dev/stderr
[ ! "$(head /tmp/$NOMBRE)" == "" ]&& cat /tmp/$NOMBRE && exit

[ "$2" == "" ] && IMDB=$(torrent-imdb "$NOMBRE") || IMDB=$2

#	falta:
#	tambien buscar sin a√±os y sin acentos

# busca en torrentz y kickass
BUSQUEDA=$(torrentz-dl "$NOMBRE" peerflix; [ ! "$IMDB" == "" ] && kickass-dl $IMDB)
[ "$BUSQUEDA" == "" ] && exit # tal vez pueda reducir el nombre

# busquedas mas filtros
NEGRA=$(cat ~/.negra)
BLANCA=$(cat ~/.blanca)
HASH=$(echo "BUSQUEDA" | grep -vi $NEGRA | grep -i $BLANCA | head -n1 | cut -d"	" -f1)

# busca solo filtrando la lista negra
[ "$HASH" == "" ] && HASH=$(echo "$BUSQUEDA" | grep -vi $NEGRA | head -n1 | cut -d"	" -f1)

# devuelve el hash y guarda el cache
[ ! "$HASH" == "" ] && echo "magnet:?xt=urn:btih:${HASH}"| tee /tmp/$NOMBRE

exit

Quehaceres
==========

* hacer una gran lista ordenada (X)
  * filtrar por calidad (x264, 1080, 720, bluray, etc)
  * si no tiene o tiene subtitulo
* si no encuentran nada en torrent levanta cosas en descarga directa


